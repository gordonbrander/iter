<!DOCTYPE html>

<html>
<head>
  <title>iter.lua</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="iter-lua">iter.lua</h1>
<p>Map, filter and transform lazy iterators.</p>
<p>iter offers the familiar <code>map()</code>, <code>filter()</code>, etc but with a twist: rather than transforming tables, iter transforms the iterator. Transformations are lazy and no work is done until iterator is consumed (usually with a <code>for</code> loop). This is faster and more memory efficient, since items are transformed one-by-one as iterator is consumed and no interim tables are created.</p>
<p>Transform iterator functions using familiar <code>map</code>, <code>filter</code>, <code>reduce</code>, etc.
Transformations are lazy and are only performed item-by-item when the final
iterator is consumed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> exports = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="create-iterators">Create Iterators</h2>
<p>These functions help you create iterators from tables.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Create the metatable we use for <code>iter_values</code> below.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> _iter_values_of = {}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_iter_values_of.__call</span><span class="hljs-params">(self)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_exhausted <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">local</span> i, v = self.<span class="hljs-built_in">next</span>(self.state, self.i)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> i <span class="hljs-keyword">then</span>
      self.is_exhausted = <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      self.i = i
      <span class="hljs-keyword">return</span> v
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Capture the state of a stateless iterator and return a stateful iterator
which will only return values. This is a lower-level function. You’ll
typically want to use <code>ivalues</code> or <code>values</code> instead.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iter_values_of</span><span class="hljs-params">(next, state, i)</span></span>
  <span class="hljs-keyword">local</span> iter = {<span class="hljs-built_in">next</span>=<span class="hljs-built_in">next</span>, state=state, i=i, is_exhausted=<span class="hljs-keyword">false</span>}
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">setmetatable</span>(iter, _iter_values_of)
<span class="hljs-keyword">end</span>
exports.iter_values_of = iter_values_of</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Iterate over the indexed values of a table.
Returns a stateful iterator that yields single values.</p>
<p>Example:</p>
<pre><code><span class="hljs-keyword">local</span> t = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
<span class="hljs-keyword">local</span> x = ivalues(t)
<span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> x <span class="hljs-keyword">do</span> <span class="hljs-built_in">print</span>(v) <span class="hljs-keyword">end</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ivalues</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">return</span> iter_values_of(<span class="hljs-built_in">ipairs</span>(t))
<span class="hljs-keyword">end</span>
exports.ivalues = ivalues</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Iterate over the keyed values of a table.
Returns a stateful iterator function that returns one value.</p>
<p>Example:</p>
<pre><code><span class="hljs-keyword">local</span> t = {a=<span class="hljs-number">1</span>, b=<span class="hljs-number">2</span>, c=<span class="hljs-number">3</span>}
<span class="hljs-keyword">local</span> x = ivalues(t)
<span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> x <span class="hljs-keyword">do</span> <span class="hljs-built_in">print</span>(v) <span class="hljs-keyword">end</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">values</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">return</span> iter_values_of(<span class="hljs-built_in">pairs</span>(t))
<span class="hljs-keyword">end</span>
exports.values = values</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create a stateful iterator of <code>{k, v}</code> pairs from a table.
Returns a stateful iterator function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">items</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">local</span> v
  <span class="hljs-keyword">local</span> <span class="hljs-built_in">next</span>, state, k = <span class="hljs-built_in">pairs</span>(t)
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    k, v = <span class="hljs-built_in">next</span>(state, k)
    <span class="hljs-keyword">return</span> {k, v}
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.items = items</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Like Lua’s built-in <code>next()</code> function, but works backwards over indexes,
from right-to-left.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prev</span><span class="hljs-params">(t, i)</span></span>
  <span class="hljs-keyword">if</span> i <span class="hljs-keyword">then</span>
    i = i - <span class="hljs-number">1</span>
    <span class="hljs-keyword">local</span> v = t[i]
    <span class="hljs-keyword">if</span> v <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">return</span> i, v
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.prev = prev</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Iterate over ipairs in reverse.
Note this is a STATELESS iterator. Use <code>rev_values</code> if you want to iterate
over only values in reverse.</p>
<pre><code><span class="hljs-keyword">for</span> i, v <span class="hljs-keyword">in</span> rev_ipairs(t) <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">print</span>(v)
<span class="hljs-keyword">end</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rev_ipairs</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">return</span> prev, t, (#t + <span class="hljs-number">1</span>)
<span class="hljs-keyword">end</span>
exports.rev_ipairs = rev_ipairs</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>A stateful iterator for reversed indexed values of table.
Returns a stateful iterator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rev_ivalues</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">return</span> iter_values_of(rev_ipairs(t))
<span class="hljs-keyword">end</span>
exports.rev_ivalues = rev_ivalues</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="transform-iterators">Transform iterators</h2>
<p>These functions will allow you to transform iterators.</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Apply a filter function to all values of the iterator, returning a new
iterator containing only the items that passed the test.
<code>predicate</code> is a function that returns a boolean value. Anything it returns
<code>true</code> for is kept.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span><span class="hljs-params">(predicate, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> predicate(v) <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> v <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.filter = filter</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Filter a stateful iterator function, returning an iterator containing only
the items that <em>fail</em> the test. This function is the compliment of <code>filter</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">(predicate, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> predicate(v) <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> v <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.remove = remove</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Map each item with function <code>a2b</code>, returning a new iterator of mapped values.</p>
<p>Note that you may also use map to filter values, by returning <code>nil</code>.
This is useful when adhering to Lua’s convention of returning <code>nil</code> for
function exceptions. Failures are automatically filtered out.</p>
<p>This function can be used to serve a similar purpose to Python’s list
comprehensions and generator expressions. It lets you write your functions
for single values, then have them deal with any iterator sequence,
returning a new iterator sequence. Like Python’s list comprehensions, you
can both map and filter the values (to filter, simply return <code>nil</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(a2b, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">local</span> xv = a2b(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Skip <code>nil</code> values, since <code>nil</code> terminates iteration in Lua.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> xv ~= <span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">return</span> xv
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.map = map</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Lift a function to become an iterator transformer.
Returns a new function that will consume an iterator and return a new
iterator, transformed with function <code>a2b</code>. Example:</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">square</span><span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> x * x <span class="hljs-keyword">end</span>
<span class="hljs-keyword">local</span> squares = lift(square)
<span class="hljs-keyword">local</span> t = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
<span class="hljs-keyword">local</span> x = iter.ivalues(t)
<span class="hljs-keyword">local</span> y = squares(x)
<span class="hljs-comment">-- &lt;1, 4, 9&gt;</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lift</span><span class="hljs-params">(a2b)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span></span>
    <span class="hljs-keyword">return</span> map(a2b, x)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.lift = lift</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Step through iterator with a reducing function and a starting <code>result value</code>.
Returns an iterator for the result at each step of the reduction.</p>
<p>Example:</p>
<pre><code><span class="hljs-keyword">local</span> v = iter.values({<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>})
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">(x, y)</span></span> <span class="hljs-keyword">return</span> x + y <span class="hljs-keyword">end</span>
<span class="hljs-keyword">local</span> r = iter.reductions(sum, <span class="hljs-number">0</span>, v)
<span class="hljs-built_in">print</span>(collect(r))
<span class="hljs-comment">--- {1, 3, 6, 10}</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reductions</span><span class="hljs-params">(step, result, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      result = step(result, v)
      <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.reductions = reductions</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Take the first <code>n</code> items of iterator.
Returns a new iterator that will terminate after yielding <code>n</code> items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">take</span><span class="hljs-params">(n, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      n = n - <span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">return</span> v
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">nil</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.take = take</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Take items from iterator while <code>predicate</code> function returns <code>true</code>.
As soon as function returns <code>false</code>, stop iteration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">take_while</span><span class="hljs-params">(predicate, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> predicate(v) <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">return</span> v
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">nil</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.take_while = take_while</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Skip the first <code>n</code> items of iterator.
Returns a new iterator that will yield items after skipping <code>n</code> items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span><span class="hljs-params">(n, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      n = n - <span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">return</span> v
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.skip = skip</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Skip items until <code>predicate</code> function returns true.
Returns a new iterator with items after <code>predicate</code> returns true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip_while</span><span class="hljs-params">(predicate, next)</span></span>
  <span class="hljs-keyword">local</span> skipping = <span class="hljs-keyword">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> skipping <span class="hljs-keyword">then</span>
        skipping = predicate(v)
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> v
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.skip_while = skip_while</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Partition an iterator into “chunks”, returning an iterator of tables
containing <code>chunk_size</code> items each.
Returns a new iterator of chunks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">partition</span><span class="hljs-params">(chunk_size, next)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> chunk = {}
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">table</span>.insert(chunk, v)
      <span class="hljs-keyword">if</span> #chunk == chunk_size <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">return</span> chunk
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If we have any values in the last chunk, return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> #chunk &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">return</span> chunk
    <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Otherwise, return nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.partition = partition</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Zip 2 iterators using function <code>f</code>.
Each step, takes one item from the left and on item from the right iterator,
and passes these items to function <code>f</code>. The return value of <code>f</code> becomes the
value at that step of the returned iterator.
Terminates on shortest iterator.</p>
<p>Example:</p>
<pre><code>zip_with(table2, iter_1, iter_2)
<span class="hljs-comment">-- &lt;{1, 2}, {3, 4}, {5, 6}, ...&gt;</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zip_with</span><span class="hljs-params">(f, next_a, next_b)</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    a = next_a()
    b = next_b()
    <span class="hljs-keyword">if</span> a ~= <span class="hljs-keyword">nil</span> <span class="hljs-keyword">and</span> b ~= <span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">return</span> f(a, b)
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.zip_with = zip_with</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Pack 2 arguments into a table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">table2</span><span class="hljs-params">(a, b)</span></span>
  <span class="hljs-keyword">return</span> {a, b}
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Zip 2 iterators into an iterator of tables made up of paired values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zip</span><span class="hljs-params">(next_a, next_b)</span></span>
  <span class="hljs-keyword">return</span> zip_with(table2, next_a, next_b)
<span class="hljs-keyword">end</span>
exports.zip = zip</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Remove adjacent duplicates from iterator. Values are compared with <code>compare</code>
function. Function gets previous and current value. If it returns true, the
pair is not considered to be a duplicate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dedupe_with</span><span class="hljs-params">(compare, next)</span></span>
  <span class="hljs-keyword">local</span> prev = dedupe
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> curr <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> compare(prev, curr) <span class="hljs-keyword">then</span>
        prev = curr
        <span class="hljs-keyword">return</span> curr
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.dedupe_with = dedupe_with

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">different</span><span class="hljs-params">(x, y)</span></span>
  <span class="hljs-keyword">return</span> x ~= y
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Remove adjacent duplicates from iterator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dedupe</span><span class="hljs-params">(next)</span></span>
  <span class="hljs-keyword">return</span> dedupe_with(different, <span class="hljs-built_in">next</span>)
<span class="hljs-keyword">end</span>
exports.dedupe = dedupe</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="reduce-iterators">Reduce Iterators</h2>
<p>These functions let you consume iterators, and transform them into a value.</p>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Reduce over an iterator and produce a result.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span><span class="hljs-params">(step, result, next)</span></span>
  <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
    result = step(result, v)
    <span class="hljs-keyword">if</span> result == <span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> result
<span class="hljs-keyword">end</span>
exports.reduce = reduce

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b)</span></span>
  <span class="hljs-keyword">return</span> a + b
<span class="hljs-keyword">end</span>
exports.add = add</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Sum over all of the values of iterator <code>next</code>, starting with number <code>start</code>.
Example:</p>
<pre><code><span class="hljs-keyword">local</span> t = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
<span class="hljs-keyword">local</span> x = iter.ivalues(t)
<span class="hljs-keyword">local</span> n = iter.sum(<span class="hljs-number">10</span>, x)
<span class="hljs-comment">-- 16</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">(start, next)</span></span>
  <span class="hljs-keyword">return</span> reduce(add, start, <span class="hljs-built_in">next</span>)
<span class="hljs-keyword">end</span>
exports.sum = sum

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span><span class="hljs-params">(t, v)</span></span>
  <span class="hljs-built_in">table</span>.insert(t, v)
  <span class="hljs-keyword">return</span> t
<span class="hljs-keyword">end</span>
exports.append = append</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Insert values from iterator into table <code>t</code>.
Mutates and returns <code>t</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extend</span><span class="hljs-params">(t, next)</span></span>
  <span class="hljs-keyword">return</span> reduce(append, t, <span class="hljs-built_in">next</span>)
<span class="hljs-keyword">end</span>
exports.extend = extend</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Collect an iterator’s values into a table.
Typical iterator workflow is to transform iterators, then collect the result.
Example:</p>
<pre><code><span class="hljs-keyword">local</span> x = iter.ivalues({<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>})
<span class="hljs-keyword">local</span> chunks = partition(<span class="hljs-number">3</span>, x)
<span class="hljs-keyword">local</span> t = collect(chunks)
<span class="hljs-built_in">print</span>(t) <span class="hljs-comment">-- {{1, 2, 3}, {4, 5}}</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collect</span><span class="hljs-params">(next)</span></span>
  <span class="hljs-keyword">return</span> extend({}, <span class="hljs-built_in">next</span>)
<span class="hljs-keyword">end</span>
exports.collect = collect

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compare_min</span><span class="hljs-params">(x, y)</span></span>
  <span class="hljs-keyword">if</span> x <span class="hljs-keyword">and</span> x &lt; y <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> x
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> y
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Get the smallest number in the iterator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">min</span><span class="hljs-params">(next, ...)</span></span>
  <span class="hljs-keyword">return</span> reduce(compare_min, <span class="hljs-keyword">nil</span>, <span class="hljs-built_in">next</span>, ...)
<span class="hljs-keyword">end</span>
exports.min = min

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compare_max</span><span class="hljs-params">(x, y)</span></span>
  <span class="hljs-keyword">if</span> x <span class="hljs-keyword">and</span> x &gt; y <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> x
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> y
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Get the largest number in the iterator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">max</span><span class="hljs-params">(next, ...)</span></span>
  <span class="hljs-keyword">return</span> reduce(compare_max, <span class="hljs-keyword">nil</span>, <span class="hljs-built_in">next</span>, ...)
<span class="hljs-keyword">end</span>
exports.max = max</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Search through iterator <code>next</code>, and return the first value that passes
the <code>predicate</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span><span class="hljs-params">(predicate, next)</span></span>
  <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> predicate(v) <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">return</span> v
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
exports.find = find

<span class="hljs-keyword">return</span> exports</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
